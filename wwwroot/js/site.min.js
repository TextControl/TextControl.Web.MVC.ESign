var TextControl=function(n){function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)})}function f(n){u=n;$("#statusDocumentThumbnail").attr("src","data:image/jpeg;base64, "+n.thumbnail);$("#statusDocumentInfo").text(n.contract.name);$("#contractUploadBox").hide();$("#contractPreviewBox").show();$("#statusDocument").addClass("status-check");$("#statusRecipient").addClass("status-active");TextControl.esign.showToast("Document successfully uploaded!");TextControl.esign.nextStep("collapseRecipient")}function e(n){$("#statusDocumentThumbnail").attr("src","data:image/jpeg;base64, "+n.thumbnail);$("#statusDocumentInfo").text(n.template.name);$("#contractUploadBox").hide();$("#contractPreviewBox").show();$("#statusDocument").addClass("status-check");TextControl.esign.showToast("Template successfully created!")}function o(n){$("#statusDocumentThumbnail").attr("src","data:image/jpeg;base64, "+n.thumbnail);$("#statusDocumentInfo").text(n.agreement.name);$("#contractUploadBox").hide();$("#contractPreviewBox").show();$("#statusDocument").addClass("status-check");TextControl.esign.showToast("Agreement successfully created!")}function r(n,t,i){$("#listRecipients").empty();n.forEach(function(n){$("#listRecipients").append('<div class="list-group-item list-group-item-action" aria-current="true"><div class="d-flex w-100 justify-content-between" ><h5 class="mb-1">'+n.name+'<\/h5><a class="btn btn-sm btn-outline-danger" onclick="TextControl.esign.removeRecipient(\''+t+"','"+i+"','"+n.email+"','"+n.name+'\');">Remove<\/a><\/div ><p class="mb-1">'+n.email+"<\/p><\/div >")});n.length!=0?$("#btnConfirmRecipients").removeClass("disabled"):$("#btnConfirmRecipients").addClass("disabled")}function s(n){$.ajax({type:"POST",url:"/envelope/new",contentType:!1,processData:!1,data:n,success:function(n){window.location.href="/envelope/create/"+n},error:function(){console.log("Error")},beforeSend:function(){$(".waitstate").addClass("visible")},complete:function(){$(".waitstate").removeClass("visible")}})}function h(n){$.ajax({type:"POST",url:"/contract/new",contentType:!1,processData:!1,data:n,success:function(n){f(n)},error:function(){console.log("Error")},beforeSend:function(){$(".waitstate").addClass("visible")},complete:function(){$(".waitstate").removeClass("visible")}})}function c(n){$.ajax({type:"POST",url:"/template/new",contentType:!1,processData:!1,data:n,success:function(n){e(n)},error:function(){console.log("Error")},beforeSend:function(){$(".waitstate").addClass("visible")},complete:function(){$(".waitstate").removeClass("visible")}})}function l(n){$.ajax({type:"POST",url:"/agreement/new",contentType:!1,processData:!1,data:n,success:function(n){o(n)},error:function(){console.log("Error")},beforeSend:function(){$(".waitstate").addClass("visible")},complete:function(){$(".waitstate").removeClass("visible")}})}var t,u;return n.esign={currentContract:function(){return u},deleteSection:function(){TXTextControl.subTextParts.getItem(n=>{TXTextControl.subTextParts.remove(n,!0,!1),TextControl.esign.updateSectionList()})},updateSectionName:function(){TXTextControl.selection.getStart(function(n){TXTextControl.paragraphs.getItemAtTextPosition(n,function(n){n.getText(n=>{var t=n.trim();t.length>30&&(t=t.substr(0,30)+"[...]");document.getElementById("section-name").value=t})})})},updateSectionList:function(){$("#availableSections").empty();TXTextControl.subTextParts.forEach(n=>{n.setHighlightMode(TXTextControl.HighlightMode.Activated,function(){n.getName(t=>{n.getData(n=>{$("#availableSections").append("<a onclick=\"TextControl.esign.activateSection('"+n+'\')" class="list-group-item list-group-item-action toolbox-item"><span class="material-icons left">wysiwyg<\/span><p class="sidebar-small">'+t+"<\/p><\/a>")})})})})},activateSection:function(n){TXTextControl.subTextParts.forEach(t=>{t.getData(i=>{i===n&&t.getStart(n=>{t.scrollTo();TXTextControl.selection.setStart(n-1,function(){TXTextControl.focus()});return})})})},addSection:function(){TXTextControl.selection.getStart(function(n){TXTextControl.selection.getLength(function(t){var u={start:n+1,length:t},r={start:0,length:0},f=document.getElementById("section-name").value;TXTextControl.paragraphs.getItemAtTextPosition(u.start,function(n){n.getStart(n=>{r.start=n,TXTextControl.paragraphs.getItemAtTextPosition(u.start+u.length,function(n){n.getStart(t=>{n.getLength(n=>{r.length=t+n-r.start,TXTextControl.subTextParts.add(f,0,r.start,r.length-1,n=>{n.addResult===1?n.subTextPart.setHighlightColor("rgba(0,255,0,.5)",function(){n.subTextPart.setData(i(),function(){TXTextControl.focus();TextControl.esign.updateSectionList()})}):TextControl.esign.showToast("Section cannot be inserted at this location.")})})})})})})})})},addFile:function(n){var t=n[0],i=new FormData;i.append(t.name,t);s(i)},addContract:function(n){var t=n[0],i=new FormData;i.append(t.name,t);h(i)},addTemplate:function(n){var t=n[0],i=new FormData;i.append(t.name,t);c(i)},addAgreement:function(n){var t=n[0],i=new FormData;i.append(t.name,t);l(i)},getDocument:function(n,t){$.ajax({type:"GET",url:"/"+t+"/document/"+n,success:function(n){TXTextControl.loadDocument(32,n,function(){TextControl.esign.checkTextFrames()})},error:function(){console.log("Error")},beforeSend:function(){$(".waitstate").addClass("visible")},complete:function(){$(".waitstate").removeClass("visible")}})},getContract:function(n){$.ajax({type:"GET",url:"/collaboration/document/"+n,success:function(n){TXTextControl.loadDocument(32,n)},error:function(){console.log("Error")},beforeSend:function(){$(".waitstate").addClass("visible")},complete:function(){$(".waitstate").removeClass("visible")}})},loadEditor:function(n){typeof TXTextControl!="undefined"&&TXTextControl.removeFromDom();$("#editor").load("/Partial/Edit/"+n);$("#editor").addClass("action");$("#main").addClass("inactive");$(".navbar").removeClass("fixed-top")},loadTemplateEditor:function(n){typeof TXTextControl!="undefined"&&TXTextControl.removeFromDom();$("#editor").load("/Partial/EditTemplate/"+n);$("#editor").addClass("action");$("#main").addClass("inactive");$(".navbar").removeClass("fixed-top")},loadAgreementEditor:function(n){typeof TXTextControl!="undefined"&&TXTextControl.removeFromDom();$("#editor").load("/Partial/EditAgreement/"+n);$("#editor").addClass("action");$("#main").addClass("inactive");$(".navbar").removeClass("fixed-top")},insertMergeField:function(){var n=new TXTextControl.MergeField;n.name="mergefield";n.text="«mergefield»";TXTextControl.addMergeField(n)},insertDateField:function(){var n=new TXTextControl.DateField;n.name="date";TXTextControl.addMergeField(n)},insertTextFrame:function(n){TXTextControl.selection.getStart(function(t){TXTextControl.signatureFields.addAnchored({width:4e3,height:2e3},TXTextControl.HorizontalAlignment.Left,t,TXTextControl.TextFrameInsertionMode.AboveTheText,t=>{t.setName("txsign_"+n),TextControl.esign.checkTextFrames()})})},checkTextFrames:function(){$(".toolbox-item-small").removeClass("checked");TXTextControl.textFrames.forEach(function(n){n.getName(function(n){$("#"+n).addClass("checked")})})},insertTextFormField:function(){TXTextControl.formFields.getCanAdd(n=>{if(n){var t=$("#formOwner").val();TXTextControl.formFields.addTextFormField(3e3,n=>{n.setName(t+":"+i())})}else TextControl.esign.showToast("Form field cannot be inserted at this location.")})},insertDropDownFormField:function(){TXTextControl.formFields.getCanAdd(n=>{if(n){var t=$("#formOwner").val();TXTextControl.formFields.addSelectionFormField(3e3,n=>{n.setEditable(!1),n.setName(t+":"+i()),n.setItems(["Entry1","Entry2"]),n.setSelectedIndex(1)})}else TextControl.esign.showToast("Form field cannot be inserted at this location.")})},insertCheckbox:function(){TXTextControl.formFields.getCanAdd(n=>{if(n){var t=$("#formOwner").val();TXTextControl.formFields.addCheckFormField(!0,n=>{n.setName(t+":"+i())})}else TextControl.esign.showToast("Form field cannot be inserted at this location.")})},insertDatePicker:function(){TXTextControl.formFields.getCanAdd(n=>{if(n){var t=$("#formOwner").val();TXTextControl.formFields.addDateFormField(1e3,n=>{n.setName(t+":"+i())})}else TextControl.esign.showToast("Form field cannot be inserted at this location.")})},copyLink:function(n){var t=document.getElementById(n);t.select();t.setSelectionRange(0,99999);document.execCommand("copy");TextControl.esign.showToast("Value copied to clipboard!")},saveEditor:function(n,t){var i={document:n};$.ajax({type:"POST",url:"/envelope/saveDocument/"+t,contentType:"application/json",data:JSON.stringify(i),success:function(){TextControl.esign.showToast("Document successfully saved!");$("#editor").removeClass("action");$("#main").removeClass("inactive");$(".navbar").addClass("fixed-top");$("#collapseSignature").load("/partial/SignatureBox/"+t)},error:function(){TextControl.esign.showToast("Something went wrong!")},beforeSend:function(){TextControl.esign.showToast("Saving...")},complete:function(){}})},saveTemplate:function(t,i){var r={document:t};$.ajax({type:"POST",url:"/template/saveDocument/"+i,contentType:"application/json",data:JSON.stringify(r),success:function(){TextControl.esign.showToast("Document successfully saved!");$("#editor").removeClass("action");$("#main").removeClass("inactive");$(".navbar").addClass("fixed-top");n.esign.getApplicationFields(i)},error:function(){TextControl.esign.showToast("Something went wrong!")},beforeSend:function(){TextControl.esign.showToast("Saving...")},complete:function(){}})},saveAgreement:function(n,t){var i={document:n};$.ajax({type:"POST",url:"/agreement/saveDocument/"+t,contentType:"application/json",data:JSON.stringify(i),success:function(){TextControl.esign.showToast("Document successfully saved!");$("#editor").removeClass("action");$("#main").removeClass("inactive");$(".navbar").addClass("fixed-top")},error:function(){TextControl.esign.showToast("Something went wrong!")},beforeSend:function(){TextControl.esign.showToast("Saving...")},complete:function(){}})},saveContract:function(n,t,i){var r={document:n};$.ajax({type:"POST",url:"/collaboration/saveDocument/"+t+"?owner="+i,contentType:"application/json",data:JSON.stringify(r),success:function(n){window.location.href=n},error:function(){TextControl.esign.showToast("Something went wrong!")},beforeSend:function(){TextControl.esign.showToast("Saving...")},complete:function(){}})},submitEnvelope:function(n){$.ajax({type:"POST",url:"/envelope/submit/"+n,contentType:"application/json",success:function(){TextControl.esign.showToast("Envelope successfully sent!");$("#statusReview").addClass("status-check");$("#submitButtons").hide();$("#readyButton").removeClass("visually-hidden")},error:function(){console.log("Error")},beforeSend:function(){$(".waitstate").addClass("visible")},complete:function(){$(".waitstate").removeClass("visible")}})},submitContract:function(n){$.ajax({type:"POST",url:"/contract/submit/"+n,contentType:"application/json",success:function(){TextControl.esign.showToast("Envelope successfully sent!");$("#statusReview").addClass("status-check");$("#submitButtons").hide();$("#readyButton").removeClass("visually-hidden")},error:function(){console.log("Error")},beforeSend:function(){$(".waitstate").addClass("visible")},complete:function(){$(".waitstate").removeClass("visible")}})},getApplicationFields:function(n){$.ajax({type:"POST",url:"/template/getfields/"+n,contentType:"application/json",success:function(t){console.log(t);$("#tx-fields").empty();$("#tx-fields").append("<form id='submitfields' method='post' action='/template/instance/"+n+"' >");t.length===0?$("#submitfields").append("<p>No merge fields found.<\/p>"):t.forEach(function(n){$("#submitfields").append("<div class='mt-2'><label for='"+n.name+"' class='form-label'>"+n.name+"<\/label><input class='form-control' type='text' placeholder='Complete this field' name='"+n.name+"' id='"+n.name+"' /><\/div>")});$("#submitfields").append("<input value='Create Instance' class='mt-5 btn btn-warning' type='submit'>")},error:function(){console.log("Error")},beforeSend:function(){$(".waitstate").addClass("visible")},complete:function(){$(".waitstate").removeClass("visible")}})},getAgreementSections:function(n){$.ajax({type:"POST",url:"/agreement/getsections/"+n,contentType:"application/json",success:function(t){if(console.log(t),$("#tx-sections").empty(),$("#tx-sections").append("<form id='submitsections' method='post' action='/agreement/instance/"+n+"' >"),t.length===0)$("#submitsections").append("<p>No sections found.<\/p>");else{var i="";t.forEach(function(n){n.active===!0&&(i="checked");$("#submitsections").append("<div class='mt-2'><input "+i+" class='form-check-input' value='true' type='checkbox' name='"+n.name+"' id='"+n.name+"' /><label for='"+n.name+"' class='form-check-label mx-2'>"+n.name+"<\/label><\/div>")})}$("#submitsections").append("<input value='Create Instance' class='mt-5 btn btn-warning' type='submit'>")},error:function(){console.log("Error")},beforeSend:function(){$(".waitstate").addClass("visible")},complete:function(){$(".waitstate").removeClass("visible")}})},submitSignaturebox:function(){$("#statusSignature").addClass("status-check");$("#statusReview").addClass("status-active");TextControl.esign.showToast("Signature box successfully updated!");TextControl.esign.nextStep("collapseReview");$("#reviewRecipient").empty();t.signers.forEach(function(n){$("#reviewRecipient").append("<li>"+n.email+"<\/li>")})},showToast:function(n){$("#liveToastMessage").text(n);var t=document.getElementById("liveToast"),i=new bootstrap.Toast(t);i.show()},removeRecipient:function(n,i,u,f){var e="/"+i+"/removerecipient/"+n,o={name:f,email:u};$.ajax({type:"POST",url:e,contentType:"application/json",data:JSON.stringify(o),success:function(u){t=u;TextControl.esign.showToast("Recipient successfully removed!");r(t.signers,n,i);$("#recipientAlreadyAdded").addClass("collapse")},error:function(){}})},receiveRecipients:function(n,i){var u="/"+i+"/receiverecipients/"+n;$.ajax({type:"GET",url:u,contentType:"application/json",success:function(u){t=u;r(t.signers,n,i);$("#signerName").val("");$("#signerEmail").val("")},error:function(){$("#recipientAlreadyAdded").removeClass("collapse")}})},submitRecipient:function(n,i){var u=document.querySelectorAll(".needs-validation"),f="/"+i+"/updaterecipient/"+n;Array.prototype.slice.call(u).forEach(function(u){if(u.addEventListener("submit",function(n){n.preventDefault();n.stopPropagation()},!1),u.checkValidity()){var e=$("#signerName").val(),o=$("#signerEmail").val(),s={name:e,email:o};$.ajax({type:"POST",url:f,contentType:"application/json",data:JSON.stringify(s),success:function(u){t=u;TextControl.esign.showToast("Recipient successfully updated!");i==="envelope"?(r(t.signers,n,i),$("#recipientAlreadyAdded").addClass("collapse"),$("#signerName").val(""),$("#signerEmail").val("")):i==="contract"&&($("#statusRecipient").addClass("status-check"),TextControl.esign.nextStep("collapseReview"),$("#reviewRecipient").text(t.signer.email))},error:function(){$("#recipientAlreadyAdded").removeClass("collapse")}})}else{u.classList.add("was-validated");return}})},confirmRecipients:function(){$("#statusRecipient").addClass("status-check");$("#statusSignature").addClass("status-active");TextControl.esign.nextStep("collapseSignature")},dropHandler:function(n){var t,i;n.preventDefault();n.dataTransfer.items?n.dataTransfer.items[0].kind==="file"&&(t=n.dataTransfer.items[0].getAsFile()):t=n.dataTransfer.files[0];i=new FormData;i.append(t.name,t);s(i)},dragOverHandler:function(n){n.preventDefault()},nextStep:function(n){$("#processSteps .collapse").each(function(){var n=document.getElementById(this.id),t=new bootstrap.Collapse(n,{toggle:!1});t.hide()});var t=document.getElementById(n),i=new bootstrap.Collapse(t,{toggle:!1});i.show();$(".status-check").parent().addClass("status-border-checked")},createNew:function(n){$.ajax({type:"POST",url:"/envelope/createnew?demo="+n,contentType:!1,processData:!1,success:function(n){window.location.href="/envelope/create/"+n},error:function(){console.log("Error")},beforeSend:function(){$(".waitstate").addClass("visible")},complete:function(){$(".waitstate").removeClass("visible")}})},createNewContract:function(){$.ajax({type:"POST",url:"/contract/createnew/",contentType:!1,processData:!1,success:function(n){f(n)},error:function(){console.log("Error")},beforeSend:function(){$(".waitstate").addClass("visible")},complete:function(){$(".waitstate").removeClass("visible")}})},createNewTemplate:function(){$.ajax({type:"POST",url:"/template/createnew/",contentType:!1,processData:!1,success:function(n){e(n)},error:function(){console.log("Error")},beforeSend:function(){$(".waitstate").addClass("visible")},complete:function(){$(".waitstate").removeClass("visible")}})},createNewAgreement:function(n){var t="";t=n===!0?"/agreement/createnew?sample=true":"/agreement/createnew?sample=false";$.ajax({type:"POST",url:t,contentType:!1,processData:!1,success:function(n){o(n)},error:function(){console.log("Error")},beforeSend:function(){$(".waitstate").addClass("visible")},complete:function(){$(".waitstate").removeClass("visible")}})}},$("#uploadbox").click(function(){$("#files").click()}),$(".prevent").click(function(n){n.stopPropagation()}),$("#processForm").submit(function(n){n.preventDefault();n.stopPropagation()}),n}(TextControl||{});